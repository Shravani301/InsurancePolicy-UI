<div class="wrapper">
    <div class="top_link">
        <button (click)="goBack()" class="btn-back ms-3 mt-2">
            Back
        </button>
    </div>

    <div class="container">
        <h2>Claims</h2>
        <div class="row mb-3">
            <div class="col-md-4 d-flex align-items-center">
                <label for="pageSizeSelect" class="form-label me-2">Page Size:</label>
                <select id="pageSizeSelect" class="form-select" (change)="onPageSizeChange($event)" style="width: auto;">
                    <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="filterSelect" class="form-label me-2">Filter By:</label>
                <select id="filterSelect" class="form-select" [(ngModel)]="sortColumn" (change)="sortClaims()">
                    <option value="customerName">Customer Name</option>
                    <option value="claimDate">Date of Apply</option>
                    <option value="claimAmount">Claim Amount</option>
                    <option value="status">Status</option>
                </select>
            </div>
            <div class="col-md-4">
                <div class="search-container">
                    <input type="number" class="form-control" [(ngModel)]="searchQuery" placeholder="Search by Claim ID ..." />
                    <button class="btn-search ms-2" (click)="onSearch()">Search</button>
                    <button *ngIf="isSearch" class="btn-reset ms-2" (click)="resetSearch()">Reset</button>
                </div>
            </div>
        </div>

        <table class="table table-striped table-bordered mt-4">
            <thead class="table-dark">
                <tr>
                    <th>Sr.</th>
                    <th>Customer Name</th>
                    <th>Date of Apply</th>
                    <th>Claim Amount</th>
                    <th>Status</th>
                    <th>Policy</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let claim of filteredClaimData; let i = index">
                    <td>{{ calculateSRNumber(i) }}</td>
                    <td>{{ claim.customerName }}</td>
                    <td>{{ claim.claimDate | date: 'dd-MM-yyyy' }}</td>
                    <td>{{ claim.claimAmount }}</td>
                    <td>
                        <span *ngIf="claim.status === 'PENDING'" class="badge bg-warning custom-badge">Pending</span>
                        <span *ngIf="claim.status === 'APPROVED'" class="badge bg-success custom-badge">Approved</span>
                        <span *ngIf="claim.status === 'REJECTED'" class="badge bg-danger custom-badge">Rejected</span>
                    </td>
                    <td>
                        <button class="btn btn-info btn-sm me-1" (click)="showPolicy(i)">View Policy</button>
                    </td>
                    <td>
                        <button *ngIf="claim.status === 'PENDING'" class="btn btn-success btn-sm me-2" (click)="approveClaim(claim.claimId)">
                            Approve
                        </button>
                        <button *ngIf="claim.status === 'PENDING'" class="btn btn-danger btn-sm" (click)="openRejectModal(claim.claimId)">
                            Reject
                        </button>
                    </td>
                </tr>
                <tr *ngIf="filteredClaimData.length === 0">
                    <td colspan="7" class="text-center">No Claim Data Found</td>
                </tr>
            </tbody>
        </table>

        <div class="d-flex justify-content-between align-items-center mt-4">
            <span>Page <b>{{ currentPage }}</b> of <b>{{ totalPages }}</b></span>
            <nav *ngIf="totalPages > 1" class="pagination-container">
                <ul class="pagination">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <button class="page-link" (click)="changePage(currentPage - 1)">Prev</button>
                    </li>
                    <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="i + 1 === currentPage">
                        <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    
    <!-- Modal for Policy Details -->
    <div
      class="modal fade"
      id="policyDetailModal"
      tabindex="-1"
      aria-labelledby="policyDetailModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="policyDetailModalLabel">Policy Details</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table table-bordered">
              <tr>
                <td>Policy No:</td>
                <td>{{ policyData.policyNo }}</td>
              </tr>
              <tr>
                <td>Scheme ID:</td>
                <td>{{ policyData.insuranceSchemeId }}</td>
              </tr>
              <tr>
                <td>Issue Date:</td>
                <td>{{ policyData.issueDate | date: 'dd-MM-yyyy' }}</td>
              </tr>
              <tr>
                <td>Maturity Date:</td>
                <td>{{ policyData.maturityDate | date: 'dd-MM-yyyy' }}</td>
              </tr>
              <tr>
                <td>Maturity Amount:</td>
                <td>
                  <span style="font-family: 'RupeeFont'">₹</span>{{ policyData.sumAssured }}
                </td>
              </tr>
              <tr>
                <td>Premium Amount:</td>
                <td>
                  <span style="font-family: 'RupeeFont'">₹</span>{{ policyData.premium }}
                </td>
              </tr>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Modal for Rejecting a Claim -->
    <div
      class="modal fade"
      id="rejectModal"
      tabindex="-1"
      aria-labelledby="rejectModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="rejectModalLabel">Reject Claim</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="claimId" class="form-label">Claim ID</label>
                <input type="text" id="claimId" class="form-control readonly-field" [value]="selectedClaimId" readonly/>
             </div>
              <div class="mb-3">
                <label for="reason" class="form-label">Reason</label>
                <textarea id="reason" class="form-control" [(ngModel)]="rejectReason"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" (click)="rejectClaim()">Reject</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <app-footer-end></app-footer-end>
  